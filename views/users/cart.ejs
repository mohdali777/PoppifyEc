<%- include('../partials/user/header') %>
<%- include('../partials/user/navbar') %>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

<div class="container">
    <h2 class="text-center mb-4">Shopping Cart</h2>
    <!-- Product Table -->
    <div class="table-responsive">
        <table class="table table-bordered align-middle text-center">
            <thead class="table-light">
                <tr>
                    <th>Product</th>
                    <th>Variant</th>
                    <th>Color</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Subtotal</th>
                    <th>Action</th> <!-- New column for delete icon -->
                </tr>
            </thead>
            <tbody>
                <% cart.items.forEach(item => { %>
                    <tr data-item-id="<%= item._id %>"> 
                        <td class="d-flex align-items-center">
                            <img style="width: 40px; height: 40px;" src="/uploads/<%= item.productImage %>" alt="<%= item.productId.name %>" class="me-2">
                            <span><%= item.productName %></span>
                        </td>
                        <td><%= item.variant %></td>
                        <td><%= item.color %></td>
                        <td>$<%= item.price %></td>
                        <td>
                            <input 
                                type="number" 
                                class="form-control mx-auto quantity-input" 
                                value="<%= item.quantity %>" 
                                min="1" 
                                id="cart-quantity-<%= item._id %>"  
                                onchange="updateCart('<%= item.productId._id %>','<%= item.color %>', '<%= item.colorQuantity %>','<%= item._id %>','<%= item.variant %>')" 
                                style="width: 60px;">
                        </td>
                        
                        <td id="item.total-<%= item._id%>">$<%= item.total %></td>
                        <td>
                            <button class="btn btn-black btn-sm" onclick="deleteCartItem('<%= item.productId._id %>','<%= item.variant %>','<%= item._id %>')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td> <!-- Delete button -->
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
    
    <!-- Cart Total -->
    <div class="row justify-content-end">
        <div class="col-md-4 cart-total">
            <h5>Cart Total</h5>
            <hr>
            <p class="d-flex justify-content-between">
                <span>Subtotal:</span>
                <span class="CartTotalPrice">$<%= cart.totalPrice %></span>
            </p>
            <p class="d-flex justify-content-between">
                <span>Shipping:</span>
                <span>Free</span>
            </p>
            <hr>
            <p class="d-flex justify-content-between fw-bold">
                <span>Total:</span>
                <span class="CartTotalPrice">$<%= cart.totalPrice %></span>
            </p>
            <a href="#" class="btn btn-checkout w-100 text-uppercase" style=" background-color: #dc3545; color: white; font-weight: bold;" onclick="proceedtoPayment()">Proceed to Checkout</a>
        </div>
    </div>
</div>

<script src="/js/cart.js"></script>

<%- include('../partials/user/footer') %>
